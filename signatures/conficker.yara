rule conficker_rsakey {
	meta:
		author = "Tillmann Werner"
		date = "2018-11-20"
		version = "1.0"
		description = "Detects RSA keys used by the four Conficker versions to authenticate commands"

	strings:
		$key_version_a = {
			51 C3 00 00 00 00 00 00
			CF F0 7B 61 89 D7 16 E8  1B 09 ED 31 45 FE 2E E7
			8A 24 B9 56 F6 73 41 36  78 EF 37 50 DF EC 86 CA
			4F E2 96 4B C3 E6 F4 50  BA 16 56 E8 4E 76 F2 5B
			72 45 57 98 7A 07 0B 97  15 17 E9 AB F6 6D 13 56
			DE 66 1A 55 AE AE 9E 94  53 EE 60 25 34 FC 01 CB
			F7 66 1D F4 B0 E9 1D 6F  E9 A9 1B 82 C1 A3 5C 6E
			E3 DA 61 65 28 AB 36 6A  A5 3E E9 EE 0A C1 3A E2
			27 43 F6 1E 0B 03 2A 3C  9B 91 FE E9 40 76 BF 25
		}

		$key_version_b = {
			51 C3 00 00 00 00 00 00
			E7 A7 2D F5 45 CA 12 49  E6 44 1E D6 72 4C 1B BA
			3C 72 F0 8B 4B EB 75 F3  5E E8 44 CD 87 56 E9 21
			E6 06 34 33 76 49 93 42  EC E8 03 36 19 A6 AD 4D
			12 59 7F 96 01 85 41 25  CB E2 83 7E 72 DF 85 B3
			DD E1 59 FB 97 78 9A 2D  B2 B6 3D E9 58 52 45 39
			1B 90 C8 9F D7 5C 2B 42  DE A6 6A D8 03 D0 F2 4C
			AF 72 24 2E 9D 8C F3 4D  2F 2F 4D F2 49 D6 89 29
			A2 C9 C6 FF F2 5F 98 B6  68 09 AD 92 10 70 D5 10
			EA 1C DA B6 BC D4 03 CC  8D 9E 8E 57 8C CF FC BC
			5B C3 9E 31 5B DA 08 8A  93 26 80 BF D2 DB 45 80
			83 33 87 AF 69 C2 F6 5F  15 99 34 14 CB 0F 88 CC
			44 29 E9 93 45 9E 7E F9  12 87 8A 93 8E 33 43 BB
			0C 40 5B 60 4C 86 40 31  17 99 65 13 E4 6C C2 8A
			E5 A4 30 D9 F3 D6 6A BB  EB DF DA 02 EC 6D 38 7E
			23 EE 11 68 8A 62 7D A8  93 93 9E C6 DC 7B F1 23
			5D 66 72 39 C8 3D E5 56  C3 20 D9 A8 9A 25 35 E4
			3B 99 D4 7E 61 D1 D7 74  50 E3 6A EB 49 5A 31 3D
			21 DE 29 4A CD 30 FC D1  FD D7 98 73 60 4B A6 53
			08 5D F9 EE 05 E6 21 97  ED D9 B7 D6 BC 00 34 B1
			76 6B BD 26 60 8A 2C 1C  B6 E6 58 2D 47 4D 40 09
			5B 83 B1 9D 3C 98 8E A2  2D 9E 5D 7A 07 F1 0D C8
			1B 26 47 B0 1A 1C 70 08  76 4C C2 9C CF 3A F3 0E
			1E C6 00 A8 15 CB 47 92  7E 1D F9 07 42 AA 92 49
			DC 04 71 ED D6 E7 DC E6  AD 3C BD 25 18 32 FA EC
			FA B7 A5 FB CC A1 49 52  BA 30 60 A7 D3 B0 A3 95
			E5 F2 DA 61 BD 27 D2 97  C0 D8 66 33 37 04 13 D2
			36 9D 3F CB 24 79 6B 2E  69 22 E1 0B AD C1 5B 48
			8A E1 D5 00 87 37 44 06  F5 AE 4C 74 4B 20 0F A3
			57 63 08 D4 57 EB F0 3A  E3 1A 03 C4 DF 9A 17 2D
			7F FD 1F 44 71 DA 49 B7  BA 3F 26 B5 DD 9C FE CA
			18 70 DB EC 99 63 84 96  30 10 80 4C 33 73 4D BC
			B2 C3 79 2C 83 68 CD 41  5C 45 ED 7D E7 BE A8 88
		}

		$key_version_c = {
			53 C3 00 00 00 00 00 00
			13 E5 A4 19 AD 58 46 33  10 1E FE C1 A1 96 4F B1
			18 FB E1 49 20 32 9C 17  E8 1C 7C BC 6D 81 31 C9
			DB 8D 7D BC A1 BB 94 E4  21 04 7D 30 AA F9 67 8C
			78 A6 41 47 CA 08 57 B9  52 00 A9 2B E0 78 D7 FC
			5A 57 FB 7C D9 D0 16 E2  2E 2C DE F6 DB 84 94 43
			E7 EE 72 1C 86 7E 81 95  59 CE 39 BB A2 20 A0 81
			63 03 09 3D 9C EF 5F EE  03 8B D9 56 21 A8 C4 FA
			B5 B1 69 20 74 30 B5 1C  EA 83 04 78 50 78 AC 1C
			8C 54 5D 2B E3 92 75 BD  D9 78 5E EB 21 43 9B A6
			16 89 D4 6B 0B 0F 0D 6A  15 47 F8 19 50 41 62 2C
			9E D8 9A 56 3B 41 7A C4  5A 44 AF FB D6 7D F9 1C
			C0 46 A3 F5 81 49 BA D6  E1 06 A8 93 F6 E7 87 83
			62 E8 C0 BC 2D 18 7A 69  1E 1A F5 19 5A B9 CE 7A
			34 DC A0 3A 2E EE 6B 12  B2 F0 2D 2E 87 6D 5F 2D
			F5 97 BC F0 53 1A 30 C5  6D C5 A4 A2 28 BE 88 AD
			E1 79 06 6E 3C 90 F3 36  F9 2F F8 05 3B 5B EA C3
			D3 01 E5 67 6C 4C 28 7E  35 B3 CD 6E 33 D3 D3 20
			2E 09 CF 30 79 4A 41 03  62 76 1D 92 B2 A4 34 88
			09 44 14 55 14 E8 EF F0  FC CB 82 E0 04 50 42 36
			DC 3D B8 92 E9 AB 13 5A  7B 0E 07 A4 EB 71 69 1C
			03 A9 0E 5E 29 43 57 D4  A8 E0 71 BD 47 6E 73 CC
			82 0B 63 81 89 6F AC 5E  59 16 3F E2 D2 DC A4 BD
			F7 77 EA 0A F3 CC 6F 4D  51 DB 7C 94 7D 57 5E 1B
			A6 A2 18 E1 C5 B6 E2 20  8E 6C 11 4F C9 1E F6 56
			93 8F 56 62 A0 11 86 1F  1D 1D 2D D7 2A E1 30 31
			30 1C A8 BF 28 0D 0E 90  DA 2D 54 B7 8C 03 44 00
			7D 5B AB C2 5F 51 34 E0  A5 BF 2D ED C3 28 D4 BB
			59 B5 F2 5E FD 5A 5B 9A  E9 39 62 B4 99 4E 35 09
			E2 A2 B1 81 2B 2F 4B DB  3E 76 62 22 52 FD 79 5B
			6E 53 70 3C BE 9E 4D AB  54 D3 9E 62 FF 59 7A 60
			FC 78 48 1E 05 2F CB 1C  F9 5F 23 91 FE 7E 42 E2
			88 B0 D3 33 87 41 00 72  4F 94 63 22 67 B9 A2 20
		}

		$key_p2pproto = {
			55 C3 00 00 00 00 00 00
			91 C4 3C 28 E0 B1 CF C9  9A BF 4A F5 92 5D E1 09
			D1 4F 8C 04 C5 D7 3C EB  78 D7 7C AD 6D 20 3F 32
			99 E3 49 C6 7B CB D6 8E  06 05 F7 68 FB EF 82 B7
			E9 4F AF 47 1D 06 3E A6  CC A6 F6 A6 FA 67 F2 02
			E5 F8 83 76 93 C2 C5 61  5C 03 33 0D 8C EB 46 E9
			DD 3C 9B EE 8D 65 BF 67  92 F7 E6 AC AC 69 EA 7B
			13 0F CA 17 A8 11 6F B9  27 AF C1 C4 67 FF 0E 32
			CB 96 C2 6C 75 1E 5C 34  3C 2C 18 7B 93 A6 60 0E
			EA B5 53 70 E6 69 E8 73  E6 71 89 09 05 98 78 40
			E9 D3 74 5B CF 3F 9E A6  C1 13 DF E1 FB 88 0A 74
			4E BA 3E 20 C7 ED 4B 13  25 D1 1B ED 2E 84 54 6D
			57 7E 8D 4B 6A 09 EA 20  3B 83 5B 89 2B ED EA BE
			09 06 AA E9 42 FB BB 1C  5D 24 D3 D7 F4 28 4D 7E
			9B FF 74 6E BB 5D 91 4C  51 76 35 49 89 7D 7D CC
			A9 33 D7 11 6C 27 5A BA  CB 46 FC 60 E0 F8 B9 F5
			9E 8B 0C FD 23 3A 4C 62  CE 10 39 D6 CF CC 13 94
			C5 EB 81 1C 00 C6 7B 63  5C 03 24 F5 72 5E 6D 29
			81 B9 D3 64 9A 07 69 20  0A 58 C0 D3 17 76 DE 11
			97 C7 BA AC FC 3E AF 39  63 77 0F C1 45 35 95 2C
			19 52 25 C8 B5 BB ED 80  07 BA 78 4E 49 6B A9 07
			17 E0 5E 89 8A AE DF B4  17 60 47 56 13 FA A2 2D
			8E 79 42 02 51 BC 40 29  E2 FA 52 0E 15 54 30 4B
			30 99 D6 6E 7E 77 D0 0E  63 B7 E4 2B 59 82 26 C9
			F5 BD F0 30 5D 7A 05 FE  AB EF FA 20 96 34 90 22
			D0 EB C5 86 86 16 D9 60  97 63 74 8A A3 DE ED 65
			BA 27 73 C5 5E 99 48 D7  D6 5C 09 5B 92 A7 A4 BA
			93 81 41 E3 40 8F 51 77  7F 82 8C 30 D6 94 E9 01
			F6 91 F1 74 DC D1 5E 4C  8E 30 C9 4F CB B5 B5 B0
			E6 70 28 61 97 F8 A6 AF  CB 86 7C 26 F6 D8 CC CA
			02 54 17 02 CA 81 A1 B3  42 A1 03 D1 10 5A 41 94
			EA 24 C9 A9 09 CA C5 E8  19 41 A1 40 98 D8 39 0A
			C1 3E B9 FC D2 6C 45 B5  6B C6 AE C1 5E 1F 73 7A
		}

	condition:
		any of them
}
